---
title: "Final Report for Data Mining & Test Mining"
subtitle: "Breadbasket Project"
author: "Lucy Bridges, Megan Morano, Wyatt Smith, Chris Willman"
output: html_notebook
---

```{r, echo = FALSE}
BreadBasketData <- read.csv("https://raw.githubusercontent.com/reisanar/datasets/master/BreadBasket.csv")
```


```{r, echo = FALSE}
library(dplyr)
library(tidyverse)
library(arules)
library(arulesViz)
```

## Introduction
Our team decided to explore the BreadBasket dataset and we used arules to exploration. We wanted to see which items were frequently bought the most on a single day and which items were the most popular at different parts of the day. After, we decided to see which items were commonly associated with each other during the many transactions.

## Data Exploration

#### Exploration Based on Time of Day

Created these two tables to show what are start and end time are, to better determine the Morning, Afternoon, and Evening data tables. 

```{r}
# top end for time spectrum
BreadBasketData %>%
  arrange(Time) %>%
  head(20)
```

```{r}
# bottom end for time spectrum
BreadBasketData %>%
  arrange(Time) %>%
  tail(20)
```
Filter data into three categories: morning, afternoon, evening.

```{r}
MorningData <- BreadBasketData %>% 
                filter(Time >= "00:00:00" & Time <= "11:59:59")   #before 12pm
AfternoonData <- BreadBasketData %>% 
                  filter(Time >= "12:00:00" & Time <= "15:59:59")   #12 to 4pm
EveningData <- BreadBasketData %>% 
                filter(Time >= "16:00:00" & Time <= "23:59:59")   #after 4pm
```

#### Summary Statistics for Breadbasket Data
```{r}
BreadBasketData
summary(BreadBasketData)
```

#### Confirming Top and Bottom End of Time Ranges
Morning Data
```{r}
MorningData %>%
  arrange(Time) %>%
  head(10)
  
MorningData %>%
  arrange(Time) %>%
  tail(10)
```

Afternoon Data
```{r}
AfternoonData %>%
 arrange(Time) %>%
 head(10)

AfternoonData %>%
 arrange(Time) %>%
 tail(10)
```

Evening Data
```{r}
EveningData %>%
 arrange(Time) %>%
 head(10)
 
EveningData %>%
 arrange(Time) %>%
 tail(10)
```

## Data Analysis

#### Converting Data to Transactional Data
```{r}
#get rid of every column except the transaction and the items
breadbasketmain <- BreadBasketData %>%
  select(Transaction, Item)
#check that it worked
breadbasketmain
#convert new set to transaction
bb_tr <- as(split(breadbasketmain[ ,"Item"], breadbasketmain[ ,"Transaction"]), "transactions")
inspect(bb_tr)
#create item frequency plot of the top 6 items
IF_bb = rev(tail(sort(itemFrequency(bb_tr)), 6))
barplot(IF_bb, las=2, cex.names=0.8)
```

#### Item Frequency Tables for Time Frames
Morning Data Item Frequency Table
```{r}
#get rid of every column except the transaction and the items
breadbasketmorning <- MorningData %>%
  select(Transaction, Item)
#check that it worked
breadbasketmorning
#convert new set to transaction
bbm_tr <- as(split(breadbasketmorning[ ,"Item"], breadbasketmorning[ ,"Transaction"]), "transactions")
inspect(bbm_tr)
#create item frequency plot of the top 6 items
IF_bbm = rev(tail(sort(itemFrequency(bbm_tr)), 6))
barplot(IF_bbm, las=2, cex.names=0.8)
```

Afternoon Data Item Frequency Table
```{r}
#get rid of every column except the transaction and the items
breadbasketafternoon <- AfternoonData %>%
  select(Transaction, Item)
#check that it worked
breadbasketafternoon
#convert new set to transaction
bba_tr <- as(split(breadbasketafternoon[ ,"Item"], breadbasketafternoon[ ,"Transaction"]), "transactions")

#create item frequency plot of the top 6 items
IF_bba = rev(tail(sort(itemFrequency(bba_tr)), 6))
barplot(IF_bba, las=2, cex.names=0.8)
```

Evening Data Item Frequency Table
```{r}
#get rid of every column except the transaction and the items
breadbasketevening <- EveningData %>%
  select(Transaction, Item)
#check that it worked
breadbasketevening
#convert new set to transaction
bbe_tr <- as(split(breadbasketevening[ ,"Item"], breadbasketevening[ ,"Transaction"]), "transactions")
inspect(bbe_tr)
#create item frequency plot of the top 6 items
IF_bbe = rev(tail(sort(itemFrequency(bbe_tr)), 6))
barplot(IF_bbe, las=2, cex.names=0.8)
```

#### Arules Anlaysis
Using the Main Dataset:
```{r}
#using the apriori function
breadbasketmain_rules <- apriori(bb_tr,
                                  parameter = list(support = 0.001,
                                                   confidence = 0.1))
#exploration
inspect(sort(breadbasketmain_rules, by = "lift"))
inspect(sort(breadbasketmain_rules, by = "count"))

#visualization
plot(breadbasketmain_rules, method = "graph", control = list(type = "items"),
     engine = "htmlwidget")
```
>Interestingly, Fudge and Jam seem to have a very high chance of occuring together. Coffee alone occurs the most.

Using the Morning Dataset:
```{r}
#using the apriori function
breadbasketmorn_rules <- apriori(bbm_tr,
                                  parameter = list(support = 0.001,
                                                   confidence = 0.1))

#exploration
inspect(sort(breadbasketmorn_rules, by = "lift"))
inspect(sort(breadbasketmorn_rules, by = "count"))

#visualization
plot(breadbasketmain_rules, method = "graph", control = list(type = "items"),
     engine = "htmlwidget")
```
>Coffee still occurs the most, but this time Pastry occurs the third-most as opposed to Tea, which is fourth in this set.Bread and tea have a high chance of being bought together with a sandwich. 

Using the Afternoon Dataset
```{r}
#using the apriori function
breadbasketaft_rules <- apriori(bba_tr,
                                  parameter = list(support = 0.001,
                                                   confidence = 0.1))

#exploration
inspect(sort(breadbasketaft_rules, by = "lift"))
inspect(sort(breadbasketaft_rules, by = "count"))

#visualization
plot(breadbasketaft_rules, method = "graph", control = list(type = "items"),
     engine = "htmlwidget")
```

>Tea reclaims its spot as third-most occuring. As with the main dataset, Salad and "Extra Salami or Feta" have a very high chance of occurring together. This is likely because the latter seems to be an optional add-on for the salad.

Using the Evening Dataset:
```{r}
#using the apriori function
breadbasketeve_rules <- apriori(bbe_tr,
                                  parameter = list(support = 0.001,
                                                   confidence = 0.1))

#exploration
inspect(sort(breadbasketeve_rules, by = "lift"))
inspect(sort(breadbasketeve_rules, by = "count"))

#visualization
plot(breadbasketeve_rules, method = "graph", control = list(type = "items"),
     engine = "htmlwidget")
```
>Coffee is purchased the most in all 4 datasets. A duck egg has an extremely high chance of being purchased with something called The Nomad. The evening dataset has the most compelling plot to me. It seems to have distinct clusters of rules as opposed to the homoscedastic mess the other 3 sets have.

## Discussion
After completing our arules research, we discovered that coffee was the most popular transactions for the main data set and was the most purchased item for morning, afternoon, and evening. The association with the highest lift in the main data set was coffee and salad with extra salami or feta. Regarding the morning transactions, bread and tea with a sandwich had the highest lift. In the afternoon, the highest lift was bread and salad with extra salami or feta. For the evening, many associations had extremely high lifts. The first 58 observations had lifts of 856. The first 862 had lifts over 100. The evening rules network shows what appear to be three distinct clusters, whereas the other three networks do not show any clusters. 

## Conclusion
Coffee appears to be a popular product at any time of day. Based on the arules analysis, the grocery store could use the information to make stocking decisions such as putting the fudge and jam (which have a high lift) far apart to force customers to view more products as they go through the store.  
